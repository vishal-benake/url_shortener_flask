{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Admin Panel</h2>
  <!-- More Actions Dropdown -->
    <div class="d-flex justify-content-end mb-3">
    <div class="btn-group">
        <button class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
            More Actions
        </button>
        <ul class="dropdown-menu">
            <li>
                <!-- <form action="{{ url_for('delete_selected') }}" method="POST" id="deleteSelectedForm"> -->
                    <button type="submit" class="dropdown-item" onclick="document.getElementById('mainForm').submit();">Delete Selected</button>
                <!-- </form> -->
            </li>

            <li>
                <form action="{{ url_for('delete_deactivated') }}" method="POST">
                    <button type="submit" class="dropdown-item text-danger">Delete All Deactivated</button>
                </form>
            </li>
             <li>
            {% if current_user.user.role == 'admin' %}
            <!-- <form action="{{ url_for('view_logs') }}" method="POST">
             <button type="submit" class="dropdown-item text-danger">View Logs</button>
            </form> -->
              <a class="dropdown-item text-danger" href="{{ url_for('ref_History') }}">Referral History</a> 
            {% endif %}
            </li>
            <li>
            {% if current_user.user.role == 'admin' %}
            <!-- <form action="{{ url_for('view_logs') }}" method="POST">
             <button type="submit" class="dropdown-item text-danger">View Logs</button>
            </form> -->
              <a class="dropdown-item text-danger" href="{{ url_for('view_logs') }}">View Logs</a> 
            {% endif %}
            </li>
        </ul>
    </div>
</div>


  <!-- <div>
    {% if current_user.user.role == 'admin' %}
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('view_logs') }}">View Logs</a>
    {% endif %}
  </div> -->
</div>

<!-- Account Manager -->
<div class="card mb-3">
  <div class="card-body">
    <h5>Account Manager</h5>
    {% if current_user.user.role == 'admin' %}
    <!-- <form class="row g-2 align-items-end" action="{{ url_for('create_user') }}" method="POST">
      <div class="col-md-4">
        <input type="text" class="form-control" name="username" placeholder="username">
      </div>
      <div class="col-md-4">
        <input type="password" class="form-control" name="password" placeholder="password">
      </div>
      <div class="col-md-2">
        <select class="form-select" name="role">
          <option value="operator" selected>Operator</option>
          <option value="admin">Admin</option>
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-primary w-100" type="submit">Create User</button>
      </div>
    </form> 
    <hr>-->
 <!-- Create referral (admin & operator) -->
    <form class="row g-2" action="{{ url_for('create_referral') }}" method="POST">
      <div class="col-md-8">
        <p class="mb-1">Create a one-time referral code (single-use):</p>
      </div>
      <div class="col-md-4 text-end">
        <button class="btn btn-outline-success btn-sm" type="submit">Create Referral</button>
      </div>
    </form>

    {% endif %}

   
  </div>
</div>



<!-- TABLE FORM START (Only one form now) -->
<form action="{{ url_for('delete_selected') }}" method="POST" id="mainForm">

<table class="table table-striped table-hover mt-3">
    <thead class="table-dark">
        <tr>
            <th>Select</th>
            <th>ID</th>
            <th>Short URL</th>
            <th>Target URL</th>
            <th>Clicks</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {% for url in urls %}
        <tr>

            <!-- Checkbox -->
            <td>
                <input type="checkbox" name="selected_urls" value="{{ url.id }}">
            </td>

            <td>{{ url.id }}</td>

            <td>
                <a href="{{ url_for('redirect_short', url_key=url.shorten_key, _external=True) }}" target="_blank">
                    {{ url.shorten_key }}
                </a>
            </td>

            <td>{{ url.target_url }}</td>

            <td>{{ url.clicks }}</td>

            <td>
                {% if url.is_active %}
                <span class="badge bg-success">Active</span>
                {% else %}
                <span class="badge bg-secondary">Inactive</span>
                {% endif %}
            </td>

            <td>
                {% if url.is_active %}
                <a href="{{ url_for('deactivate_url', url_id=url.id) }}"
                   class="btn btn-sm btn-warning">
                    Deactivate
                </a>
                {% else %}
                <form action="{{ url_for('reactivate_url', url_id=url.id) }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-success">Reactivate</button>
                </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>

</table>

</form>

{% endblock %}