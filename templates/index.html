{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6">
    <h2 class="mb-3 text-center">Shorten Your URL</h2>

    <form method="POST">
      <div class="mb-3">
        <input type="url" class="form-control" name="target_url"
               placeholder="Enter a valid URL (https://example.com)" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Shorten</button>
    </form>

    {% if short_url %}
    <div class="card mt-4 shadow-sm border-primary" id="short-card">
      <div class="card-body d-flex justify-content-between align-items-center">

        <span id="short-url"
              class="fw-bold text-truncate"
              style="max-width: 80%;">{{ short_url }}</span>

        <button class="btn btn-outline-success btn-sm" id="copy-btn">
          <i class="bi bi-clipboard"></i> Copy
        </button>

      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const copyBtn = document.getElementById("copy-btn");
    if (!copyBtn) return;

    copyBtn.addEventListener("click", function () {
        const urlSpan = document.getElementById("short-url");
        const card = document.getElementById("short-card");

        navigator.clipboard.writeText(urlSpan.innerText).then(() => {

            // show toast that auto-hides
            showToast("Copied: " + urlSpan.innerText, "success", 2000);

            // fade + remove ONLY this card
            card.classList.add("fade-out");
            setTimeout(() => card.remove(), 600);
        });
    });
});
</script>

<style>
.fade-out {
    animation: fadeOut 0.6s ease forwards;
}
@keyframes fadeOut {
    from { opacity: 1; transform: translateY(0px); }
    to   { opacity: 0; transform: translateY(-8px); }
}
</style>

<!-- FIXED TOAST FUNCTION -->
<script>
function showToast(message, type = "info", duration = 3000) {
    // Create container if not found
    let container = document.getElementById("toast-container");
    if (!container) {
        container = document.createElement("div");
        container.id = "toast-container";
        container.className = "toast-container position-fixed top-0 end-0 p-3";
        container.style.zIndex = "2000";
        document.body.appendChild(container);
    }

    // Create toast element
    const toastEl = document.createElement("div");
    toastEl.className = `toast text-bg-${type} border-0`;
    toastEl.setAttribute("role", "alert");
    toastEl.setAttribute("data-bs-autohide", "true");
    toastEl.setAttribute("data-bs-delay", duration);

    toastEl.innerHTML = `
      <div class="toast-body">${message}</div>
    `;

    container.appendChild(toastEl);
    const toast = bootstrap.Toast.getOrCreateInstance(toastEl);
    toast.show();

    toastEl.addEventListener("hidden.bs.toast", () => toastEl.remove());
}
</script>

{% endblock %}
